{{ define "main" }}
<article class="max-w-5xl mx-auto px-4 md:px-6 py-6 md:py-12">
  <!-- メインビジュアル -->
  {{ if .Params.image }}
  <div class="mb-8 rounded-xl overflow-hidden shadow-lg">
    <img src="{{ .Params.image }}" alt="{{ .Title }}" class="w-full h-auto object-cover">
  </div>
  {{ end }}

  <!-- ヘッダー -->
  <header class="mb-8">
    <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold text-gray-900 dark:text-white mb-4">
      {{ .Title }}
    </h1>
    <div class="flex flex-wrap items-center gap-4 text-sm text-gray-500 dark:text-white mb-4">
      <span>{{ .Date.Format "2006-01-02" }}</span>
      {{ with .Params.categories }}
        <span class="px-3 py-1 bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded-full text-xs font-medium">
          {{ index . 0 | upper }}
        </span>
      {{ end }}
      {{ with .Params.author }}
        <span>{{ . }}</span>
      {{ end }}
    </div>
    {{ with .Params.summary }}
      <p class="text-lg text-gray-700 dark:text-white leading-relaxed">
        {{ . }}
      </p>
    {{ end }}
  </header>

  <!-- 本文 -->
  <div class="prose prose-lg dark:prose-invert max-w-none text-gray-800 dark:text-gray-200 leading-relaxed">
    {{ .Content }}
  </div>

  <!-- 関連作品 -->
  {{ if ne .Params.show_related false }}
    {{ $current := . }}
    {{ $category := index .Params.categories 0 }}
    {{ $allWorks := where .Site.RegularPages "Section" "works" }}
    {{ $related := slice }}

    {{ range $allWorks }}
      {{ if and (ne .Permalink $current.Permalink) (in .Params.categories $category) }}
        {{ $related = $related | append . }}
      {{ end }}
    {{ end }}

    {{ $related = first 3 $related }}

    {{ if gt (len $related) 0 }}
    <section class="mt-16 pt-8 border-t border-gray-200 dark:border-white">
      <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-8">Related Works</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        {{ range $related }}
        <a class="bg-white dark:bg-black border border-gray-200 dark:border-white rounded-xl overflow-hidden hover:shadow-xl transition-all duration-300 hover:-translate-y-1" href="{{ .RelPermalink }}">
          <div class="w-full h-48 overflow-hidden bg-gray-100 dark:bg-gray-700">
            {{ if .Params.image }}
              <img src="{{ .Params.image }}" alt="{{ .Title }}" class="w-full h-full object-cover transition-transform duration-300 hover:scale-110">
            {{ else }}
              <img src="/img/noimage.png" alt="No image" class="w-full h-full object-cover">
            {{ end }}
          </div>
          <div class="p-6">
            <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2 line-clamp-2">
              {{ .Title }}
            </h3>
            {{ with .Params.summary }}
              <p class="text-gray-600 dark:text-white text-sm line-clamp-3">
                {{ . | plainify | truncate 60 }}
              </p>
            {{ end }}
          </div>
        </a>
        {{ end }}
      </div>
    </section>
    {{ end }}
  {{ end }}
</article>
{{ end }}
